<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat en Tiempo Real</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #121212;
            color: white;
        }

        #chatContainer {
            width: 80%;
            max-width: 600px;
            border: 1px solid #444;
            padding: 10px;
            background-color: #222;
            border-radius: 10px;
            overflow-y: auto;
            height: 400px;
        }

        #messageInput {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #333;
            color: white;
        }

        .message {
            margin: 10px 0;
            padding: 5px;
            background-color: #444;
            border-radius: 5px;
        }

        .message.user {
            background-color: #3e8e41;
        }

        .message.bot {
            background-color: #3b8baf;
        }
    </style>
</head>
<body>
    <div id="chatContainer">
        <!-- Mensajes del chat aparecerán aquí -->
    </div>
    <input id="messageInput" type="text" placeholder="Escribe un mensaje..." />
    
    <script>
        // Conexión WebSocket con el servidor correcto
        const ws = new WebSocket('wss://astro.streamelements.com');
        
        // Configuración de la suscripción al WebSocket para el canal
        const subscribeData = {
            type: "subscribe",
            nonce: "unique_nonce",  // Un identificador único para la solicitud
            data: {
                topic: "channel.follow",  // Tema del WebSocket que se desea seguir
                room: "YOUR_CHANNEL_ID",   // Aquí pon tu Channel ID
                token: "YOUR_ACCESS_TOKEN", // Tu token de autenticación
                token_type: "jwt"          // Tipo de token (puede ser "apikey", "jwt", o "oauth")
            }
        };

        // Función para mostrar los mensajes del chat
        function displayMessage(message, className) {
            const chatContainer = document.getElementById("chatContainer");
            const messageElement = document.createElement("div");
            messageElement.classList.add("message", className);
            messageElement.textContent = message;
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Desplazarse al último mensaje
        }

        // Al abrir el WebSocket, suscribimos al canal
        ws.onopen = function () {
            console.log("Conexión WebSocket abierta");
            ws.send(JSON.stringify(subscribeData));
        };

        // Recibiendo mensajes desde el WebSocket
        ws.onmessage = function (event) {
            const message = JSON.parse(event.data);

            // Ejemplo: Mostrar mensaje en la interfaz cuando alguien sigue el canal
            if (message.type === "message" && message.data.message) {
                displayMessage(message.data.message, "bot");
            }
        };

        // Error en la conexión WebSocket
        ws.onerror = function (error) {
            console.error("Error en WebSocket:", error);
        };

        // Cerrar WebSocket
        ws.onclose = function () {
            console.log("Conexión WebSocket cerrada");
        };

        // Capturar evento cuando se presiona "Enter" en el input del mensaje
        document.getElementById("messageInput").addEventListener("keypress", function (event) {
            if (event.key === "Enter" && event.target.value.trim() !== "") {
                const message = event.target.value;
                displayMessage(message, "user");

                // Aquí puedes añadir código para enviar el mensaje al WebSocket o procesarlo de alguna manera
                console.log("Mensaje enviado:", message);

                // Limpiar el campo de entrada
                event.target.value = "";
            }
        });
    </script>
</body>
</html>
